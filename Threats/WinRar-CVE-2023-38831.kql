//Defender
//More generic query.
DeviceProcessEvents
| where Timestamp >ago(90d)
| where InitiatingProcessVersionInfoOriginalFileName=~"WinRAR.exe"
| summarize count() by FileName


DeviceProcessEvents
| where Timestamp >ago(90d)
| where InitiatingProcessVersionInfoOriginalFileName=~"WinRar.exe"
| where ProcessVersionInfoOriginalFileName=~"cmd.exe" and (ProcessCommandLine contains @"\AppData\Local\Temp\Rar$" and ProcessCommandLine matches regex @"\.[a-zA-Z\s]+\.[a-zA-Z\s]+") //any file with double extension.


DeviceFileEvents
| where Timestamp >ago(90d)
| where InitiatingProcessVersionInfoOriginalFileName=~"WinRar.exe"
| where FolderPath contains @"AppData\Local\Temp\Rar$" and FolderPath matches regex @"\.[a-zA-Z\s]+\.[a-zA-Z\s]+$" //any file with double extension.




//Sysmon
//More Generic One
vimProcessCreateMicrosoftSysmon 
| where ActingProcessName endswith "WinRar.exe"
| summarize count() by TargetFileName

vimProcessCreateMicrosoftSysmon 
| where ActingProcessName endswith "WinRar.exe"
| where CommandLine contains @"\AppData\Local\Temp"  or TargetProcessFilename=~"cmd.exe"


vimProcessCreateMicrosoftSysmon
| where ActingProcessName contains "WinRar.exe"
| where TargetProcessFilename =~"cmd.exe" and (CommandLine contains @"\AppData\Local\Temp\Rar$"  and CommandLine matches regex @"\.[a-zA-Z\s]+\.[a-zA-Z\s]+") //any file with double extension.


vimFileEventMicrosoftSysmonCreated
| where TimeGenerated >ago(1d)
| where ActingProcessName endswith "WinRar.exe"
| where TargetFilePath contains @"AppData\Local\Temp\Rar$" and  TargetFilePath matches regex @"\.[a-zA-Z\s]+\.[a-zA-Z\s]+$" //any file with double extension.
